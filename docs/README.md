# DistributedDataBase-CPNModel
اعضای گروه:
1. امیرحسین اکبر
2. کسری اسکندری
3. رعنا امانی

اين مثال يک پايگاه داده توزيع شده بسيار
ساده با n سايت های مختلف را توصيف می کند (n
يک عدد صحيح مثبت است که فرض می شود بيشتر از
يا مساوی ٣ باشد). هر سايت دارای يک کپی از
تمام داده ها است و اين نسخه توسط يک مدير
پايگاه داده محلی اداره می شود. بنابراين ما
مجموعه ای از مديران پايگاه داده را داريم:

```
DBM = {d1, d2, …, dn}
```
هر مدير مجاز است يک نسخه به روزرسانی را
برای نسخه خود از پايگاه داده ايجاد کند -
اما پس از آن بايد برای ساير مديران پيامی
ارسال کند (برای اين که آنها بتوانند به
روزرسانی مشابه را روی نسخه خود از پايگاه
داده انجام دهند). در اين مثال ما به محتوای
پيام علاقه نداريم - بلکه فقط به اطلاعات مربوط
به عنوان است که فرستنده و گيرنده را توصيف
می کند. بنابراين ما مجموعه ای از پيام های
زير را داريم:
```
MES = {(s,r) | s,r∈DBM ∧ s≠r}
```
که در آن فرستنده و گيرنده r دو مدير پايگاه
داده متفاوت هستند. هنگامی که يک مدير پايگاه
داده يک بروزرسانی را ايجاد می کند ، بايد
پيامی را به همه مديران ديگر ، يعنی پيام های
زير ارسال کند:

<a href="https://www.codecogs.com/eqnedit.php?latex=\sum_{r\in&space;DBM-\{s\}}&space;\1`(s,r)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\sum_{r\in&space;DBM-\{s\}}&space;\1`(s,r)" title="\sum_{r\in DBM-\{s\}} \1`(s,r)" /></a>

که در این جمع نشان می دهد که ما با اضافه
کردن چند مجموعه ، مجموعه ای با اندازه 
n-1
تشکيل می دهيم 
که هر يک از
آنها يک عنصر واحد دارد. چند مجموعه حاصل
شامل يک ظاهر از هر پيام است که دارای عنوان
ارسال کننده است.
اين تعاريف با هم اظهارات زير را به ما ارائه
می دهند:

```
constants:      n : integer (* n≥3 *);

colour sets:    DBM = {d1, d2, …, dn};
                MES = {(s,r) | s,r∈DBM ∧ s≠r}
                E = {e};
 variables:     s,r : DBM;
 ```

<a href="https://www.codecogs.com/eqnedit.php?latex=functions:&space;Mes(s)=&space;\sum_{r\in&space;DBM-\{s\}}&space;\1`(s,r)" target="_blank"><img src="https://latex.codecogs.com/gif.latex?functions:&space;Mes(s)=&space;\sum_{r\in&space;DBM-\{s\}}&space;\1`(s,r)" title="functions: Mes(s)= \sum_{r\in DBM-\{s\}} \1`(s,r)" /></a>

حال اجازه دهيد نگاهی به 
CP-net
 بيندازيم (در
صفحه بعد نشان داده شده است). هر مدير بانک
اطلاعاتی دارای سه حالت مختلف است: غيرفعال ،
انتظار (برای تصديق) و عملکرد (به روزرسانی
درخواست شده توسط مدير ديگر). هر پيام می
تواند در چهار حالت مختلف باشد: بلا استفاده ،
ارسال شده ، دريافت شده و تأييد. سرانجام ،
سيستم می تواند فعال يا
Passive
باشد
در ابتدا همه مديران غيرفعال هستند و همه
پيامها بدون استفاده هستند. اين توسط عبارات
اوليه سازی نشان داده شده است.

`DBM.all()`
مجموعه ای را توليد می کند که دقيقاК يک شکل
از هر رنگ را در مجموعه رنگ
DBM
نشان می
دهد. به طور مشابه ،
`MES.all()`
مجموعه ای را
توليد می کند که دقيقاК يک شکل از هر رنگ را
در مجموعه رنگ 
MES
ايجاد می کند.
هنگامی که يک مدير تصميم به ايجاد يک به
روزرسانی و ارسال پيام می کند ، وضعيت آن از
غيرفعال به انتظار تغيير می کند ، در حالی که
وضعيت پيام های خود 
MES
از
Unused
به
ارسال می شود. حالا مدير بايد منتظر بماند تا
ساير مديران به روزرسانی را تصديق کنند.
هنگامی که يکی از اين مديران ديگر ، 
 ، يک
پيام دريافت می کند ، وضعيت آن از حالت
غيرفعال به انجام (بروزرسانی) تغيير می کند ،
در حالی که وضعيت پيام (های ،
 (مربوطه از
ارسال به دريافت تغيير می کند. در مرحله بعد
مدير پايگاه داده r ممکن است يک اذعان ارسال
کند (می گويد که به روزرسانی را تمام کرده
است) و وضعيت آن از عملکرد برگشت به غيرفعال
تغيير می کند ، در حالی که وضعيت پيام (ها ،
r (تغيير می کند از دريافت به تصديق. هنگامی
که همه پيام های پيام (ها) ، که توسط مدير
ارسال شده است ، مورد تأييد قرار گرفتند ،
مدير ممکن است تمام قدردانی ها و تغيير وضعيت
آن را از انتظار در بازگشت به غيرفعال دريافت
کند ، در حالی که وضعيت پيام های آن از (ها) 
تغيير می کند از مورد تأييد بازگشت به
بلااستفاده قرار گرفت.

```
val     n = 4;
color   DBM = index d with 1..n;
volor   PR = product DBM * DBM;
fun     diff(x,y) = (x<>y);
color   MES = subset PR by diff;
color   E = with e;
fun     Mes(s) = PR.mult(1`s, DBM.all()--1`s);
var     s,r: DBM;
```
برای اطمينان از سازگاری بين نسخه های مختلف پايگاه داده ، اين طرح همگام سازی ساده فقط به روز
رسانی در يک زمان اجازه می دهد. به عبارت ديگر ، وقتی مدير شروع به روزرسانی کرده است ، اين
کار بايد قبل از شروع به روزرسانی ديگر توسط همه مديران انجام شود. اين محروميت متقابل توسط
محلی
Passive
که در صورت غيرفعال بودن سيستم مشخص می شود) تضمين می شود. در ابتدا
Passive
حاوی يک نشانه الکترونيکی واحد است (همانطور که در مورد سيستم تخصيص منابع ، ما از
e برای نشان دادن "نشانه های بدون استفاده" ، يعنی علائم بدون اطلاعات پيوست استفاده می کنيم).
لازم به ذکر است که توضيحات ما در مورد سيستم پايگاه داده بسيار سطح بالا (و غيرواقعی) است - به
اين معنا که محروميت متقابل با استفاده از مکانيسم جهانی (مکانی منفعل) توصيف می شود. برای پياده
سازی سيستم پايگاه داده بر روی سخت افزار توزيع شده ، محروميت متقابل بايد از طريق "مکانيسم توزيع
شده" اداره شود. چنين عملی را می توان با يک شبکه خالص دقيق تر توصيف کرد - که همچنين می تواند
نحوه برخورد با "از دست دادن پيام" و "سايتهای معلول" را ارائه دهد. 

همچنين لازم به ذکر است که توضيحات 
CP-net
سيستم پايگاه داده دارای چندين مکان کار برکنار است
- که می توانند بدون تغيير رفتار حذف شوند (يعنی توالی های احتمالی مراحل). به عنوان نمونه ، می
توانيم استفاده نشده را حذف کنيم. سپس فقط از آن پيامهايی که در حال استفاده هستند استفاده می شود (يعنی
در يکی از ايالات ارسال شده ، دريافت يا تأييد شده). همچنين می توانيم
Performing, Active
را کنار
بگذاريم. داشتن مکان های زائد در يک شبکه CP بسيار متداول است ، و اين اغلب درک را آسان تر می
کند - زيرا توضيحات مفصل تر و کامل تری از وضعيت های مختلف سيستم ارائه می دهد.
سيستم پايگاه داده می تواند برای نشان دادن سه مفهوم اساسی از شبکه های پتری استفاده شود: همزمانی
، تعارض و وابستگی علی. در علامت گذاری اوليه سيستم پايگاه داده ، انتقال به روزرسانی و ارسال پيام
برای همه مديران فعال شده است ، اما فقط در يک زمان می تواند برای يک مدير اتفاق بيفتد (با توجه به
تنها نشانه الکترونيکی روی Passive .(به اين وضعيت يک نزاع گفته می شود (زيرا عناصر الزام آور
بطور جداگانه فعال هستند ، اما به طور همزمان فعال نيستند) - و ما می گوييم که انتقال به روزرسانی و
ارسال پيام ها با خودش در تضاد است.
هنگامی که انتقال به روزرسانی و ارسال پيام ها برای برخی از مديران اتفاق افتاده است ، انتقال دريافت
پيام به طور همزمان برای همه مديران متفاوت از s فعال می شود. اين وضعيت به همزمانی گفته می شود
- و می گوييم انتقال دريافت يک پيام برای خودش همزمان است.
انتقال دريافت همه تأييدها فقط زمانی امکان پذير است که انتقال به روزرسانی و ارسال پيام برای برخی
از مديرها اتفاق افتاده است ، و انتقال ها دريافت پيام و ارسال يک تشکر برای همه مديران متفاوت از s
اتفاق افتاده است. اين وضعيت وابستگی ی
عل ناميده می شود (زيرا ما يک عنصر الزام آور داريم که تنها ّ
پس از وقوع برخی عناصر اتصال دهنده ديگر می تواند فعال شود).
ما مکانها و کمان ها را به سه روش مختلف ترسيم کرده ايم. اين معنی رسمی ندارد ، اما باعث می شود
شبکه برای انسان قابل خواندن بيشتر باشد - زيرا اين امر باعث می شود تفاوت بين: تغيير حالت مديران
پايگاه داده ها (خطوط ضخيم) ، تغيير حالت پيام ها (خطوط نازک) و مکانيسم آسان تر شود. برای اطمينان
از محروميت متقابل (خطوط سايه دار). اين تمايز همچنين ممکن است به تثبيت بيشتر مدل کمک کند (زيرا
به مدرس کمک می کند تا ببيند که او تمام قسمت های سيستم را پوشش داده است يا خير).
حال اجازه دهيد توضيح دهيد که چرا اعلاميه های ML CPN) در کادر در پايين net-CP (برابر با اعلاميه
های بيان شده در ابتدای اين بخش است.
خط ١ n را ثابت می داند و مقدار آن را به ۴ می دهد. ثابت در شبکه های CP به روشی استفاده می شود
که شبيه زبان های برنامه نويسی است. اين بدان معنی است که ما می توانيم تعدادی از مديران پايگاه داده
را با تغيير اظهارنامه n تغيير دهيم (به جای اينکه تعداد زيادی بيانيه و کتيبه خالص را تغيير دهيم). 
خط ٢ مجموعه رنگ DBM را اعلام می کند. اين کار با استفاده از يک سازنده مجموعه ای ساخته شده
در رنگ انجام می شود که به راحتی می توان مجموعه های رنگی ايندکس شده را اعلام کرد ، يعنی
مجموعه هايی از فرم
```
{ xi ،1 + xi ،… ،1 – xk ،xk }
```
که x يک شناسه است (يعنی يک رشته متن) ،
در حالی که i و k دو عدد صحيح هستند (با استفاده از دو عبارت عدد صحيح مشخص شده اند).

خطوط 5-5 مجموعه رنگ MES را اعلام می کنند. ابتدا ما یک مجموعه روابط عمومی را که محصول دکارتی DBM با خودش است اعلام می کنیم. کامپایلر CPN ML به طور خودکار یک تابع PR.mult را اعلام می کند که با استفاده از آن می توانیم دو مجموعه چند DBM را با هم ضرب کنیم تا یک مجموعه روابط عمومی را بدست آوریم. به عنوان نمونه ،
داریم:
```
PR.mult(2`d3+1`d4, 1`d2+3`d3) = 2`(d3,d2)+ 6`(d3,d3) + 1`(d4,d2) +
3`(d4,d3).
```
تابع
`PR.mult`
در خط ۷ برای تعریف استفاده شده است
. بعد ما يک تابع diff را اعلام می کنيم. اين تابع دو آرگومان
طول می کشد و آزمايش می کند که آيا اينها با يکديگر متفاوت هستند (<> معنی). سرانجام ، ما MES را
دقيقا شامل عناصری است که تفاوت (ها ، r ً (به عنوان زير مجموعه روابط عمومی اعلام می کنيم که
برای آنها صادق است. عملکرد 
`MES.all()`
همچنين توسط کامپايلر ML CPN به طور خودکار توليد می
شود و يک مجموعه چند مجموعه ثابت را محاسبه می کند. اين تابع در بيان اوليه استفاده نشده استفاده می
شود. 

خط ۶ مجموعه رنگ E را اعلام می کند ، که به روشی مشابه در سيستم تخصيص منابع استفاده می شود. 

